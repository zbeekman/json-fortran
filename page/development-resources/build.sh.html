<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	 
	 <meta name="description" content="JSON-Fortran â€“ A Fortran 2008 JSON API">
    
    <meta name="author" content="Chris MacMackin" >
    <link rel="icon" href="../../favicon.png">

    <title>build.sh &ndash; JSON-Fortran</title>

    <link href="../../css/bootstrap.min.css" rel="stylesheet">
    <link href="../../css/pygments.css" rel="stylesheet">
    <link href="../../css/font-awesome.min.css" rel="stylesheet">
    <link href="../../css/local.css" rel="stylesheet">
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../../js/jquery-2.1.3.min.js"></script>
    <script src="../../js/svg-pan-zoom.min.js"></script>

    
    <script src="../../tipuesearch/tipuesearch_content.js"></script>
    <link  href="../../tipuesearch/tipuesearch.css" rel="stylesheet">
    <script src="../../tipuesearch/tipuesearch_set.js"></script>
    <script src="../../tipuesearch/tipuesearch.js"></script>
    

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../../index.html">JSON-Fortran </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
				
            <li><a href='../../page/index.html'>Other Docs</a></li>
				
                
            <li><a href="../../lists/files.html">Source Files</a></li>
				
				
            <li><a href="../../lists/modules.html">Modules</a></li>
				
				
            <li><a href="../../lists/procedures.html">Procedures</a></li>
				
				
            <li><a href="../../lists/absint.html">Abstract Interfaces</a></li>
								
            <li><a href="../../lists/types.html">Derived Types</a></li>
				
				
          </ul>
        
        <form action="../../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  <div class="row">
    <h1>build.sh</h1>
    <div class="row">
    <div class="col-lg-12">
    <div class="well well-sm" style="min-height: 40px;">
      <ul class="list-inline" style="margin-bottom:0px; display:inline">
         
         
<!--
        
-->
      </ul>
        <ol class="breadcrumb in-well">
      
         <li><a href='../../page/index.html'>Other Docs</a></li>
      
         <li><a href='../../page/development-resources/index.html'>Development Resources</a></li>
      
         <li class="active">build.sh</li>
      </ol>
    </div>
    </div>
    </div>
  </div>
  
  <div class="row">
    
    <div class="col-lg-3">
        <div class="well toc">
          <ul class="nav nav-stacked nav-pills">
            <li role="presentation" class="title"><a href='../../page/index.html'>Other Docs</a></li>
          </ul>
          <hr>
          <ul class="nav nav-stacked nav-pills">
            
            <li role="presentation">
            <a href='../../page/./README.html'>Github README</a>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/development-resources/index.html'>Development Resources</a>
            
            <ul class="nav nav-stacked nav-pills">
              
            <li role="presentation">
            <a href='../../page/development-resources/CONTRIBUTING.html'>Contributing Guidelines</a>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/development-resources/LICENSE.html'>JSON-Fortran License</a>
            
            </li>
            
            <li role="presentation" class="disabled">
            <a href='../../page/development-resources/build.sh.html'>build.sh</a>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/development-resources/codecov.yml.html'>codecov.yml</a>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/development-resources/deploy.sh.html'>deploy.sh</a>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/development-resources/gccr.pl.html'>gccr.pl</a>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/development-resources/json_module.F90.gcov.html'>Coverage Analysis</a>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/development-resources/release-checklist.html'>Release Checklist</a>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/development-resources/travis.yml.html'>.travis.yml</a>
            
            </li>
            
            </ul>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/releases/index.html'>Official Releases</a>
            
            </li>
            
          </ul>
        </div>
    </div>
    
    <div class="col-lg-9" id='text'>
        <p>Below is the build script used to build <abbr title="JavaScript Object Notation: A human friendly syntax for storing and exchanging data">JSON</abbr>-Fortran using
<a href="https://github.com/szaghi/FoBiS">FoBiS.py</a>.</p>
<div class="codehilite"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1">#</span>
<span class="c1">#  NAME</span>
<span class="c1">#    build.sh</span>
<span class="c1">#</span>
<span class="c1">#  DESCRIPTION</span>
<span class="c1">#    Build the JSON-Fortran library and unit tests.</span>
<span class="c1">#</span>
<span class="c1">#  USAGE</span>
<span class="c1">#    build.sh [--compiler {intel|gnu|&lt;other&gt;}] [--cflags &#39;&lt;custom compiler flags here&gt;&#39;]</span>
<span class="c1">#             [--coverage [{yes|no}]] [--profile [{yes|no}]] [--skip-tests [{yes|no}]]</span>
<span class="c1">#             [--skip-documentation [{yes|no}]] [--enable-unicode [{yes|no}]] [--help]</span>
<span class="c1">#             [--clean]</span>
<span class="c1">#</span>
<span class="c1">#    By default, if invoked without any flags, this build script will build the</span>
<span class="c1">#    JSON-Fortran library using gfortran,</span>
<span class="c1">#        without :</span>
<span class="c1">#            unicode support</span>
<span class="c1">#            coverage flags</span>
<span class="c1">#            profiling flags</span>
<span class="c1">#        with :</span>
<span class="c1">#            unit tests enabled</span>
<span class="c1">#            documentation (if FORD is installed)</span>
<span class="c1">#</span>
<span class="c1">#     More recent (right-most) flags will override preceding flags</span>
<span class="c1">#     flags:</span>
<span class="c1">#        --compiler : gnu or gfortran for gfortran, intel or ifort for intel compiler</span>
<span class="c1">#                     A custom compiler may also be specified here, e.g. ftn</span>
<span class="c1">#</span>
<span class="c1">#        --cflags : Enter any aditiol/custom compiler flags here and make sure they are</span>
<span class="c1">#                   properly quoted</span>
<span class="c1">#</span>
<span class="c1">#        --help : Print a usage message and exit.</span>
<span class="c1">#</span>
<span class="c1">#        --clean : Delete generated files and clean up after builds</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#        The following flags all (optionally) accept an argument, &quot;yes&quot; or &quot;no.&quot; If</span>
<span class="c1">#        no argument is passed, &quot;yes&quot; will be assumed.</span>
<span class="c1">#</span>
<span class="c1">#        --enable-unicode [{yes|no}]: Request that the JSON-Fortran be built with (or</span>
<span class="c1">#                                     without) unicode/UCS4 support. If your compiler</span>
<span class="c1">#                                     does NOT support ISO 10646/UCS4 and it was</span>
<span class="c1">#                                     requested, then a warning is printed and the</span>
<span class="c1">#                                     library is built without UCS4 support.</span>
<span class="c1">#</span>
<span class="c1">#        --coverage [{yes|no}]: Compile the library and tests with code coverage enabled</span>
<span class="c1">#                               or disabled.</span>
<span class="c1">#</span>
<span class="c1">#        --profile [{yes|no}]: Compile the library and tests with code profiling enabled</span>
<span class="c1">#                              or disabled</span>
<span class="c1">#</span>
<span class="c1">#        --skip-tests [{yes|no}]: Skip (or don&#39;t skip) building and running the json-</span>
<span class="c1">#                                 fortran unit tests</span>
<span class="c1">#</span>
<span class="c1">#        --skip-documentation [{yes|no}]: Skip (or don&#39;t skip) building the json-</span>
<span class="c1">#                                         fortran documentation using FORD</span>
<span class="c1">#</span>
<span class="c1">#  REQUIRES</span>
<span class="c1">#    FoBiS.py : https://github.com/szaghi/FoBiS      [version 1.2.5 or later required]</span>
<span class="c1">#    FORD     : https://github.com/cmacmackin/ford   [version 4.0.0 or later]</span>
<span class="c1">#</span>
<span class="c1">#  AUTHOR</span>
<span class="c1">#    Jacob Williams : 12/27/2014</span>
<span class="c1">#</span>

<span class="nb">set</span> -o errexit

<span class="nv">FORDMD</span><span class="o">=</span><span class="s1">&#39;json-fortran.md&#39;</span>        <span class="c1"># FORD options file for building documentation</span>
<span class="nv">DOCDIR</span><span class="o">=</span><span class="s1">&#39;./doc/&#39;</span>                 <span class="c1"># build directory for documentation</span>
<span class="nv">PAGESDIR</span><span class="o">=</span><span class="s1">&#39;./pages/&#39;</span>             <span class="c1"># Directory for FORD &quot;pages&quot;</span>
<span class="nv">SRCDIR</span><span class="o">=</span><span class="s1">&#39;./src/&#39;</span>                 <span class="c1"># library source directory</span>
<span class="nv">TESTDIR</span><span class="o">=</span><span class="s1">&#39;./src/tests/&#39;</span>          <span class="c1"># unit test source directory</span>
<span class="nv">INTROSPECDIR</span><span class="o">=</span><span class="s1">&#39;./src/tests/introspection/&#39;</span> <span class="c1"># pre compile configuration tests directory</span>
<span class="nv">UCS4TESTCODE</span><span class="o">=</span><span class="s1">&#39;test_iso_10646_support.f90&#39;</span>
<span class="nv">BINDIR</span><span class="o">=</span><span class="s1">&#39;./bin/&#39;</span>                 <span class="c1"># build directory for unit tests</span>
<span class="nv">LIBDIR</span><span class="o">=</span><span class="s1">&#39;./lib/&#39;</span>                 <span class="c1"># build directory for library</span>
<span class="nv">MODCODE</span><span class="o">=</span><span class="s1">&#39;json_module.F90&#39;</span>       <span class="c1"># json module file name</span>
<span class="nv">LIBOUT</span><span class="o">=</span><span class="s1">&#39;libjsonfortran.a&#39;</span>       <span class="c1"># name of json library</span>


<span class="c1"># The following warning might be triggered by ifort unless explicitly silenced:</span>
<span class="c1"># warning #7601: F2008 standard does not allow an internal procedure to be an actual argument procedure name. (R1214.4).</span>
<span class="c1"># In the context of F2008 this is an erroneous warning.</span>
<span class="c1"># See https://prd1idz.cps.intel.com/en-us/forums/topic/486629</span>
<span class="nv">INTELCOMPILERFLAGS</span><span class="o">=</span><span class="s1">&#39;-c -O2 -warn -stand f08 -diag-disable 7601 -diag-disable 4013 -diag-disable 5142 -traceback&#39;</span>
<span class="c1">#INTELCOMPILERFLAGS=&#39;-c -O2 -warn -traceback -stand f08 -assume protect_parens -assume buffered_io -check all&#39;</span>

<span class="nv">GNUCOMPILERFLAGS</span><span class="o">=</span><span class="s1">&#39;-c -O2 -fbacktrace -Wall -Wextra -Wno-maybe-uninitialized -Wno-unused-function -pedantic -std=f2008 -fno-omit-frame-pointer&#39;</span>

<span class="nv">FCOMPILER</span><span class="o">=</span><span class="s1">&#39;gnu&#39;</span> <span class="c1">#Set default compiler to gfortran</span>


<span class="c1"># command line argument parsing</span>
<span class="c1"># N.B.: Arguments appearing later in the list take precidence over those appearing earlier.</span>
<span class="c1">#       e.g., &quot;./build.sh --compiler intel --coverage no --compiler gnu --coverage&quot; will</span>
<span class="c1">#       perform the build with the GFORTRAN compiler, and coverage analysis</span>

<span class="nv">script_name</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>basename <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">&quot;</span>

<span class="c1"># usage message</span>
print_usage <span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo</span> -e <span class="s2">&quot;\n\nUsage:\n&quot;</span>
    <span class="nb">echo</span> -e <span class="s2">&quot;</span><span class="si">${</span><span class="nv">script_name</span><span class="si">}</span><span class="s2"> [--compiler {intel|gnu|&lt;other&gt;}] [--cflags &#39;&lt;custom compiler flags here&gt;&#39;]\n\</span>
<span class="s2">         [--coverage [{yes|no}]] [--profile [{yes|no}]] [--skip-tests [{yes|no}]]\n\</span>
<span class="s2">         [--skip-documentation [{yes|no}]] [--enable-unicode [{yes|no}]] [--help]&quot;</span>
    <span class="nb">echo</span> <span class="s2">&quot;&quot;</span>
    <span class="nb">echo</span> -e <span class="s2">&quot;Any flags that take an optional yes or no argument will default to &#39;yes&#39; when no\n\</span>
<span class="s2">argument is passed. Additionally, A custom compiler may be passed to the &#39;compiler&#39;\n\</span>
<span class="s2">flag, but appropriate &#39;cflags&#39; should also be passed to the script.\n\n&quot;</span>
<span class="o">}</span>


<span class="k">while</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$#</span><span class="s2">&quot;</span> -ge <span class="s2">&quot;1&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">do</span> <span class="c1"># Get command line arguments while there are more left to process</span>

    <span class="nv">key</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> <span class="c1"># Command line args are key-value pairs or value-less keys</span>

    <span class="k">case</span> <span class="nv">$key</span> in <span class="c1">#find known keys</span>
    --compiler<span class="o">)</span> <span class="c1">#pick the compiler. Defaults to gfortran, but intel or custom compilers can be used</span>
        <span class="k">case</span> <span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span> in
        intel<span class="p">|</span>Intel<span class="p">|</span>INTEL<span class="p">|</span>ifort<span class="o">)</span>
            <span class="nv">FCOMPILER</span><span class="o">=</span><span class="s1">&#39;Intel&#39;</span>
            <span class="nv">FCOMPILERFLAGS</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$INTELCOMPILERFLAGS</span><span class="s2">&quot;</span>
            <span class="nb">shift</span>
            <span class="p">;;</span>
        gnu<span class="p">|</span>Gnu<span class="p">|</span>GNU<span class="p">|</span>gfortran<span class="p">|</span>Gfortran<span class="p">|</span>GFortran<span class="p">|</span>GFORTRAN<span class="o">)</span>
            <span class="nv">FCOMPILER</span><span class="o">=</span><span class="s1">&#39;gnu&#39;</span>
            <span class="nv">FCOMPILERFLAGS</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$GNUCOMPILERFLAGS</span><span class="s2">&quot;</span>
            <span class="nb">shift</span>
            <span class="p">;;</span>
        *<span class="o">)</span>
            <span class="nv">FCOMPILER</span><span class="o">=</span><span class="s2">&quot;custom&quot;</span>
            <span class="nb">echo</span> <span class="s2">&quot;Warning: Trying to build with unsupported compiler, </span><span class="nv">$2</span><span class="s2">.&quot;</span> 1&gt;<span class="p">&amp;</span>2
            <span class="nb">echo</span> <span class="s2">&quot;Please ensure you set appropriate --cflags and (single) quote them&quot;</span> 1&gt;<span class="p">&amp;</span>2
            <span class="nv">FC</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>
            <span class="nb">shift</span>
            <span class="p">;;</span>
        <span class="k">esac</span>
        <span class="p">;;</span>
    --cflags<span class="o">)</span>
        <span class="nv">FCOMPILERFLAGS</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>
        <span class="c1"># no good way to check that the user didn&#39;t do something questionable</span>
        <span class="nb">shift</span>
        <span class="p">;;</span>
    --enable-unicode<span class="o">)</span>
        <span class="k">case</span> <span class="nv">$2</span> in
        yes<span class="p">|</span>Yes<span class="p">|</span>YES<span class="o">)</span>
            <span class="nv">TRY_UNICODE</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span>
            <span class="nb">shift</span>
            <span class="p">;;</span>
        no<span class="p">|</span>No<span class="p">|</span>NO<span class="o">)</span>
            <span class="nv">TRY_UNICODE</span><span class="o">=</span><span class="s2">&quot;no&quot;</span>
            <span class="nb">shift</span>
            <span class="p">;;</span>
        *<span class="o">)</span>
            <span class="nv">TRY_UNICODE</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span>
            <span class="c1"># don&#39;t shift; $2 is next arg</span>
            <span class="p">;;</span>
        <span class="k">esac</span>
        <span class="p">;;</span>
    --coverage<span class="o">)</span> <span class="c1"># enable coverage</span>
        <span class="k">case</span> <span class="nv">$2</span> in
        yes<span class="p">|</span>Yes<span class="p">|</span>YES<span class="o">)</span>
            <span class="nv">CODE_COVERAGE</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span>
            <span class="nb">shift</span>
            <span class="p">;;</span>
        no<span class="p">|</span>No<span class="p">|</span>NO<span class="o">)</span>
            <span class="nv">CODE_COVERAGE</span><span class="o">=</span><span class="s2">&quot;no&quot;</span>
            <span class="nb">shift</span>
            <span class="p">;;</span>
        *<span class="o">)</span>
            <span class="nv">CODE_COVERAGE</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span>
            <span class="c1"># don&#39;t shift because $2 is some other flag</span>
            <span class="p">;;</span>
        <span class="k">esac</span>
        <span class="p">;;</span>
    --profile<span class="o">)</span> <span class="c1">#nable profiling</span>
        <span class="k">case</span> <span class="nv">$2</span> in
        yes<span class="p">|</span>Yes<span class="p">|</span>YES<span class="o">)</span>
            <span class="nv">CODE_PROFILE</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span>
            <span class="nb">shift</span>
            <span class="p">;;</span>
        no<span class="p">|</span>No<span class="p">|</span>NO<span class="o">)</span>
            <span class="nv">CODE_PROFILE</span><span class="o">=</span><span class="s2">&quot;no&quot;</span>
            <span class="nb">shift</span>
            <span class="p">;;</span>
        *<span class="o">)</span>
            <span class="nv">CODE_PROFILE</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span>
            <span class="c1"># don&#39;t shift because $2 is some other flag</span>
            <span class="p">;;</span>
        <span class="k">esac</span>
        <span class="p">;;</span>
    --skip-tests<span class="o">)</span> <span class="c1"># skip tests</span>
        <span class="k">case</span> <span class="nv">$2</span> in
        yes<span class="p">|</span>Yes<span class="p">|</span>YES<span class="o">)</span>
            <span class="nv">JF_SKIP_TESTS</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span>
            <span class="nb">shift</span>
            <span class="p">;;</span>
        no<span class="p">|</span>No<span class="p">|</span>NO<span class="o">)</span>
            <span class="nv">JF_SKIP_TESTS</span><span class="o">=</span><span class="s2">&quot;no&quot;</span>
            <span class="nb">shift</span>
            <span class="p">;;</span>
        *<span class="o">)</span>
            <span class="nv">JF_SKIP_TESTS</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span>
            <span class="p">;;</span>
        <span class="k">esac</span>
        <span class="p">;;</span>
    --skip-documentation<span class="o">)</span>
        <span class="k">case</span> <span class="nv">$2</span> in
        yes<span class="p">|</span>Yes<span class="p">|</span>YES<span class="o">)</span>
            <span class="nv">JF_SKIP_DOCS</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span>
            <span class="nb">shift</span>
            <span class="p">;;</span>
        no<span class="p">|</span>No<span class="p">|</span>NO<span class="o">)</span>
            <span class="nv">JF_SKIP_DOCS</span><span class="o">=</span><span class="s2">&quot;no&quot;</span>
            <span class="nb">shift</span>
            <span class="p">;;</span>
        *<span class="o">)</span>
            <span class="nv">JF_SKIP_DOCS</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span>
            <span class="p">;;</span>
        <span class="k">esac</span>
        <span class="p">;;</span>
    --help<span class="o">)</span>
        print_usage
        <span class="nb">exit</span> 0
        <span class="p">;;</span>
    --clean<span class="o">)</span>
        rm -r -- src<span class="o">{</span>,/tests<span class="o">}</span>/*.o <span class="nv">$DOCDIR</span>* <span class="nv">$LIBDIR</span>* <span class="nv">$BINDIR</span>* *.gcov*
        <span class="p">;;</span>
    *<span class="o">)</span>
        <span class="nb">echo</span> <span class="s2">&quot;Unknown flag, \&quot;</span><span class="nv">$1</span><span class="s2">\&quot;, passed to </span><span class="si">${</span><span class="nv">script_name</span><span class="si">}</span><span class="s2">!&quot;</span> 2&gt;<span class="p">&amp;</span>1
        print_usage
        <span class="nb">exit</span> 1
        <span class="p">;;</span>
    <span class="k">esac</span>
    <span class="nb">shift</span> <span class="c1"># look at next argument</span>
<span class="k">done</span> <span class="c1"># with argument parsing loop</span>

<span class="c1"># if no compiler selected, then we&#39;re defaulting to gnu, and need to check that the cflags are set</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$FCOMPILER</span><span class="s2">&quot;</span> <span class="o">=</span> <span class="s1">&#39;gnu&#39;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> -z <span class="s2">&quot;</span><span class="nv">$FCOMPILERFLAGS</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nv">FCOMPILERFLAGS</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$GNUCOMPILERFLAGS</span><span class="s2">&quot;</span>
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[[</span> <span class="nv">$CODE_COVERAGE</span> <span class="o">==</span> <span class="o">[</span>yY<span class="o">]</span>* <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;Trying to compile with code coverage instrumentation.&quot;</span>
    <span class="nv">COVERAGE</span><span class="o">=</span><span class="s2">&quot;-coverage&quot;</span>
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[[</span> <span class="nv">$CODE_PROFILE</span> <span class="o">==</span> <span class="o">[</span>yY<span class="o">]</span>* <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;Trying to compile with code profiling instrumentation.&quot;</span>
    <span class="nv">PROFILING</span><span class="o">=</span><span class="s2">&quot;-profile&quot;</span>
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[[</span> <span class="nv">$FCOMPILER</span> <span class="o">==</span> custom <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;Trying to compile with custom compiler, </span><span class="nv">$FC</span><span class="s2">&quot;</span>
    <span class="nv">CUSTOM</span><span class="o">=(</span><span class="s2">&quot;-fc&quot;</span> <span class="s2">&quot;</span><span class="nv">$FC</span><span class="s2">&quot;</span><span class="o">)</span>
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[[</span> <span class="nv">$TRY_UNICODE</span> <span class="o">==</span> <span class="o">[</span>yY<span class="o">]</span>* <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;Trying to compile library with Unicode/UCS4 support&quot;</span>
    FoBiS.py build -ch -compiler <span class="s2">&quot;</span><span class="si">${</span><span class="nv">FCOMPILER</span><span class="si">}</span><span class="s2">&quot;</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">CUSTOM</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span> -cflags <span class="s2">&quot;</span><span class="si">${</span><span class="nv">FCOMPILERFLAGS</span><span class="si">}</span><span class="s2">&quot;</span> -dbld <span class="s2">&quot;</span><span class="si">${</span><span class="nv">BINDIR</span><span class="si">}</span><span class="s2">&quot;</span> -s <span class="s2">&quot;</span><span class="si">${</span><span class="nv">INTROSPECDIR</span><span class="si">}</span><span class="s2">&quot;</span> -dmod ./ -dobj ./ -t <span class="s2">&quot;</span><span class="si">${</span><span class="nv">UCS4TESTCODE</span><span class="si">}</span><span class="s2">&quot;</span> -o <span class="s2">&quot;</span><span class="si">${</span><span class="nv">UCS4TESTCODE</span><span class="p">%.f90</span><span class="si">}</span><span class="s2">&quot;</span> -colors
    <span class="k">if</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">BINDIR</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">UCS4TESTCODE</span><span class="p">%.f90</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span> <span class="k">then</span>
    <span class="nv">DEFINES</span><span class="o">=</span><span class="s2">&quot;-DUSE_UCS4 -Wunused-function&quot;</span>
    <span class="k">fi</span>
<span class="k">fi</span>

<span class="c1">#build the stand-alone library:</span>
<span class="nb">echo</span> <span class="s2">&quot;&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;Building library...&quot;</span>

FoBiS.py build -ch -compiler <span class="si">${</span><span class="nv">FCOMPILER</span><span class="si">}</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">CUSTOM</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span> -cflags <span class="s2">&quot;</span><span class="si">${</span><span class="nv">FCOMPILERFLAGS</span><span class="si">}</span><span class="s2"> </span><span class="si">${</span><span class="nv">DEFINES</span><span class="si">}</span><span class="s2">&quot;</span> <span class="si">${</span><span class="nv">COVERAGE</span><span class="si">}</span> <span class="si">${</span><span class="nv">PROFILING</span><span class="si">}</span> -dbld <span class="si">${</span><span class="nv">LIBDIR</span><span class="si">}</span> -s <span class="si">${</span><span class="nv">SRCDIR</span><span class="si">}</span> -dmod ./ -dobj ./ -t <span class="si">${</span><span class="nv">MODCODE</span><span class="si">}</span> -o <span class="si">${</span><span class="nv">LIBOUT</span><span class="si">}</span> -mklib static -colors

<span class="c1">#build the unit tests (uses the above library):</span>
<span class="k">if</span> <span class="o">[[</span> <span class="nv">$JF_SKIP_TESTS</span> !<span class="o">=</span> <span class="o">[</span>yY<span class="o">]</span>* <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;&quot;</span>
    <span class="nb">echo</span> <span class="s2">&quot;Building unit tests...&quot;</span>

    <span class="c1"># FoBiS.py PR #45 work around</span>
    <span class="o">[</span> -d <span class="s2">&quot;</span><span class="nv">$BINDIR</span><span class="s2">&quot;</span> <span class="o">]</span> <span class="o">||</span> mkdir <span class="s2">&quot;</span><span class="nv">$BINDIR</span><span class="s2">&quot;</span>

    <span class="k">for</span> TEST in <span class="s2">&quot;</span><span class="si">${</span><span class="nv">TESTDIR</span><span class="p">%/</span><span class="si">}</span><span class="s2">&quot;</span>/jf_test_*.<span class="o">[</span>fF<span class="o">]</span>90<span class="p">;</span> <span class="k">do</span>
    <span class="nv">THIS_TEST</span><span class="o">=</span><span class="si">${</span><span class="nv">TEST</span><span class="p">##*/</span><span class="si">}</span>
    <span class="nb">echo</span> <span class="s2">&quot;Build </span><span class="si">${</span><span class="nv">THIS_TEST</span><span class="p">%.[fF]90</span><span class="si">}</span><span class="s2">&quot;</span>
    FoBiS.py build -ch -compiler <span class="si">${</span><span class="nv">FCOMPILER</span><span class="si">}</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">CUSTOM</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span> -cflags <span class="s2">&quot;</span><span class="si">${</span><span class="nv">FCOMPILERFLAGS</span><span class="si">}</span><span class="s2"> </span><span class="si">${</span><span class="nv">DEFINES</span><span class="si">}</span><span class="s2">&quot;</span> <span class="si">${</span><span class="nv">COVERAGE</span><span class="si">}</span> <span class="si">${</span><span class="nv">PROFILING</span><span class="si">}</span> -dbld <span class="s2">&quot;</span><span class="si">${</span><span class="nv">BINDIR</span><span class="si">}</span><span class="s2">&quot;</span> -s <span class="s2">&quot;</span><span class="si">${</span><span class="nv">TESTDIR</span><span class="si">}</span><span class="s2">&quot;</span> -i <span class="s2">&quot;</span><span class="si">${</span><span class="nv">LIBDIR</span><span class="si">}</span><span class="s2">&quot;</span> -libs <span class="s2">&quot;</span><span class="si">${</span><span class="nv">LIBDIR</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">LIBOUT</span><span class="si">}</span><span class="s2">&quot;</span> -dmod ./ -dobj ./ -t <span class="s2">&quot;</span><span class="si">${</span><span class="nv">THIS_TEST</span><span class="si">}</span><span class="s2">&quot;</span> -o <span class="s2">&quot;</span><span class="si">${</span><span class="nv">THIS_TEST</span><span class="p">%.[fF]90</span><span class="si">}</span><span class="s2">&quot;</span> -colors
    <span class="k">done</span>
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;Skip building the unit tests since \$JF_SKIP_TESTS has been set to &#39;true&#39;.&quot;</span>
<span class="k">fi</span>

<span class="c1"># Run all the tests unless $JF_SKIP_TESTS</span>
<span class="nb">echo</span> <span class="s2">&quot;&quot;</span>
<span class="k">if</span> <span class="o">[[</span> <span class="nv">$JF_SKIP_TESTS</span> !<span class="o">=</span> <span class="o">[</span>yY<span class="o">]</span>* <span class="o">]]</span> <span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;Running tests...&quot;</span>
    <span class="nv">OLD_IGNORES</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$GLOBIGNORE</span><span class="s2">&quot;</span>
    <span class="c1"># run next commands in subshell to avoid `cd -`</span>
    <span class="o">(</span><span class="nb">cd</span> <span class="s2">&quot;</span><span class="nv">$BINDIR</span><span class="s2">&quot;</span>
    <span class="nv">GLOBIGNORE</span><span class="o">=</span><span class="s1">&#39;*.*&#39;</span>
    <span class="c1">#</span>
    <span class="k">for</span> TEST in jf_test_*<span class="p">;</span> <span class="k">do</span>
        <span class="c1"># It would be nice to run json output printed to stdout through jsonlint, however,</span>
        <span class="c1"># some tests output more than one json structure and these need to be split</span>
        <span class="nb">echo</span> <span class="s2">&quot;Running </span><span class="si">${</span><span class="nv">TEST</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="s2">&quot;./</span><span class="si">${</span><span class="nv">TEST</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">done</span><span class="o">)</span>
    <span class="nv">GLOBIGNORE</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$OLD_IGNORES</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="o">[[</span> <span class="nv">$CODE_COVERAGE</span> <span class="o">=</span> <span class="o">[</span>yY<span class="o">]</span>* <span class="o">]]</span> <span class="p">;</span> <span class="k">then</span>
        <span class="k">for</span> SRCFILE in json_string_utilities.F90 json_value_module.F90 json_file_module.F90 <span class="p">;</span> <span class="k">do</span>
            <span class="o">[</span> -f <span class="si">${</span><span class="nv">SRCDIR</span><span class="si">}${</span><span class="nv">SRCFILE</span><span class="si">}</span>.gcov <span class="o">]</span> <span class="o">&amp;&amp;</span> rm <span class="si">${</span><span class="nv">SRCDIR</span><span class="si">}${</span><span class="nv">SRCFILE</span><span class="si">}</span>.gcov
            gcov -o <span class="nv">$LIBDIR</span> <span class="si">${</span><span class="nv">SRCDIR</span><span class="si">}${</span><span class="nv">SRCFILE</span><span class="si">}</span>
            <span class="k">if</span> <span class="o">[[</span> <span class="nv">$TRY_UNICODE</span> <span class="o">=</span> <span class="o">[</span>yY<span class="o">]</span>* <span class="o">]]</span> <span class="p">;</span> <span class="k">then</span>
                <span class="c1"># gcov/gfortran bug work around</span>
                awk -F<span class="s1">&#39;:&#39;</span> <span class="s1">&#39;{line=&quot;&quot;; for(i=2;i&lt;=NF;i++){line=line&quot;:&quot;$i}; if (NR &gt; 1) print $1 prevline; prevline=line}; END{print &quot;        -&quot;prevline}&#39;</span> <span class="si">${</span><span class="nv">SRCFILE</span><span class="si">}</span>.gcov &gt; <span class="si">${</span><span class="nv">SRCFILE</span><span class="si">}</span>.gcov.fixed <span class="o">&amp;&amp;</span> <span class="se">\</span>
                mv <span class="si">${</span><span class="nv">SRCFILE</span><span class="si">}</span>.gcov<span class="o">{</span>.fixed,<span class="o">}</span>
                <span class="c1"># rename so we can merge coverage info</span>
                mv <span class="si">${</span><span class="nv">SRCFILE</span><span class="si">}</span>.gcov <span class="si">${</span><span class="nv">SRCFILE</span><span class="si">}</span>-unicode.gcov
            <span class="k">else</span>
                <span class="c1"># rename so we can merge coverage info</span>
                mv <span class="si">${</span><span class="nv">SRCFILE</span><span class="si">}</span>.gcov <span class="si">${</span><span class="nv">SRCFILE</span><span class="si">}</span>-no-unicode.gcov
            <span class="k">fi</span>
            <span class="k">if</span> <span class="o">[</span> -f <span class="si">${</span><span class="nv">SRCFILE</span><span class="si">}</span>-unicode.gcov <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> -f <span class="si">${</span><span class="nv">SRCFILE</span><span class="si">}</span>-no-unicode.gcov <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
                <span class="c1"># merge them</span>
                ./pages/development-resources/gccr.pl -n -c <span class="si">${</span><span class="nv">SRCFILE</span><span class="si">}</span>-no-unicode.gcov no-unicode <span class="se">\</span>
                                  <span class="si">${</span><span class="nv">SRCFILE</span><span class="si">}</span>-unicode.gcov unicode &gt; <span class="si">${</span><span class="nv">SRCFILE</span><span class="si">}</span>.gcov
            <span class="k">else</span>
                cp <span class="si">${</span><span class="nv">SRCFILE</span><span class="si">}</span>*-unicode.gcov <span class="si">${</span><span class="nv">SRCFILE</span><span class="si">}</span>.gcov
            <span class="k">fi</span>
        <span class="k">done</span>

        FoBiS.py rule -gcov_analyzer .
        <span class="k">for</span> SRCFILE in json_string_utilities.F90 json_value_module.F90 json_file_module.F90 <span class="p">;</span> <span class="k">do</span>
            sed -i<span class="s2">&quot;bak&quot;</span> -E <span class="s1">&#39;s; \*\*([a-zA-Z]+[a-zA-Z0-9_]*)\*\*; \*\*[[\1]]\*\*;&#39;</span> <span class="si">${</span><span class="nv">SRCFILE</span><span class="si">}</span>.gcov.md
            sed -i<span class="s2">&quot;bak&quot;</span> -E <span class="s2">&quot;s;, line ([0-9]+);, line [\1](https://github.com/jacobwilliams/json-fortran/blob/master/src/</span><span class="si">${</span><span class="nv">SRCFILE</span><span class="si">}</span><span class="s2">#L\1);&quot;</span> <span class="si">${</span><span class="nv">SRCFILE</span><span class="si">}</span>.gcov.md
        <span class="k">done</span>
        gcov -o <span class="nv">$BINDIR</span> <span class="si">${</span><span class="nv">TESTDIR</span><span class="si">}</span>*.<span class="o">[</span>Ff<span class="o">]</span>90
    <span class="k">fi</span>
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;Skip running the unit tests since \$JF_SKIP_TESTS has been set to </span><span class="si">${</span><span class="nv">JF_SKIP_TESTS</span><span class="si">}</span><span class="s2">.&quot;</span>
<span class="k">fi</span>

<span class="c1">#build the documentation with ford (if present):</span>
<span class="nb">echo</span> <span class="s2">&quot;&quot;</span>
<span class="k">if</span> <span class="o">[[</span> <span class="nv">$JF_SKIP_DOCS</span> !<span class="o">=</span> <span class="o">[</span>yY<span class="o">]</span>* <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
    <span class="k">if</span> <span class="nb">hash</span> ford 2&gt;/dev/null<span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;Building documentation...&quot;</span>
    <span class="o">[[</span> <span class="nv">$TRY_UNICODE</span> <span class="o">=</span> <span class="o">[</span>yY<span class="o">]</span>* <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">MACRO_FLAG</span><span class="o">=(</span><span class="s2">&quot;-m&quot;</span> <span class="s2">&quot;USE_UCS4&quot;</span><span class="o">)</span>
    ford --debug <span class="s2">&quot;</span><span class="si">${</span><span class="nv">MACRO_FLAG</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span> -p <span class="s2">&quot;</span><span class="nv">$PAGESDIR</span><span class="s2">&quot;</span> <span class="s2">&quot;</span><span class="nv">$FORDMD</span><span class="s2">&quot;</span>
    <span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;FORD not found! Install using: sudo pip install ford&quot;</span>
    <span class="k">fi</span>
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;Skip building documentation since \$JF_SKIP_DOCS has been set to </span><span class="si">${</span><span class="nv">JF_SKIP_DOCS</span><span class="si">}</span><span class="s2">.&quot;</span>
<span class="k">fi</span>
</pre></div>


<div class="footnote">
<hr>
<ol>
<li id="fn-1">
<p>Documentation pages for a specific release do not contain links
back to this page and the master documentation. Please use your
browser's back button to navigate back to
<a href="https://jacobwilliams.github.com/json-fortran/">https://jacobwilliams.github.com/json-fortran/</a>.&#160;<a class="footnote-backref" href="#fnref-1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>
    </div>
  </div>

    <hr>
    <footer>
      <div class="row">
        <div class="col-md-4">&copy; 2016 </div>
        <div class="col-md-4"><span class="text-center"> JSON-Fortran was developed by Jacob Williams</span></div>
        <div class="col-md-4">
          <span class="pull-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
            
          </span>
        </div>
      </div>
      <br>
    </footer>
    </div> <!-- /container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js'],
        'HTML-CSS': { 
           styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: '#000000 ! important'} }
        }
      });
    </script>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  </body>
</html>